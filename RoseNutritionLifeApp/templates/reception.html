{% extends 'layout.html' %}


{% block content %}
{% load static %}  


<div class="p-2 mt-5"></div>

<!-- start listing patients -->
<!-- Patients Table -->
{% if rank in "it_officer,director,vice_director,reception" %}

      <span id="category_title" class="d-flex justify-content-center align-items-center mt-3  mx-3 p-1 rounded" style="color:rgb(4, 70, 39);font-size:1.2rem;">
          <i class="bi bi-capsule-pill text-success mx-1" style="font-size:1.2rem;"></i>LIST OF PATIENTS </span>

        <div class="alert alert-info alert-dismissible mx-3 mt-2 shadow border-0 bg-white">
        <span class="d-flex justify-content-center aling-items-center text-info">
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          <i class="bi bi-info-circle mx-2" style="font-size:1rem;" ></i> Make Sure After Register Patients Seen On List
        </span>
      </div>

  <div class="mb-4 mt-2 d-flex justify-content-center  align-items-center">
<div class="shadow  container bg-white p-3 "
     style=" border-radius:20px;">
     
      <h3 class="d-flex justify-content-center mt-3"><!-- List of Patients --> List of Patients </h3>
            <!-- counts + add -->
      <span class="d-flex justify-content-center align-items-center gap-2 mb-2">
        <a class="text-light btn btn-sm" style="background-color: rgb(4, 70, 39); border-radius:30px;">
          <!-- Total Patients --> List of patients  {{ patient_count }}
        </a>
        <a class="patient-post-btn text-light btn btn-sm" style="background-color: rgb(4, 70, 39); border-radius:30px;">
         <i class="bi bi-person-arms-up" style="font-size:0.8rem"></i>
          Register Patient
        </a>
      </span>  

      <div class="mx-3 mb-2">
    <input type="text" id="patientSearchInput" placeholder="Search patient by name or mobile" class="form-control border-info">
      </div>

          <div class="table-responsive-sm">

          <form method="GET" action="">
                {% csrf_token %}
      <table class="table table-bordered table-hover table-striped">
        <thead>
          <tr>
            <th><input type="checkbox" id="select-all-patients"></th>
            <th>Name</th>
            <th>Gender</th>
            <th>Region</th>
            <th>Postal-Address</th>
            <th>Email</th>
            <th>MobileNo</th>
            <th>MembershipNo</th>
            {% if rank in "it_officer,director,vice_director" %}
            <th>Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody  id="patientsTableBody">
          {% for patient in patients %}
          <tr>
              <td><input type="checkbox" name="selected_patients" value="{{ patient.id }}"></td>
              <td>{{ patient.full_name }}</td>
              <td class="text-center">{{ patient.gender }}</td>
              <td>{{ patient.region }}</td>
              <td class="text-center">{{ patient.postal_address }}</td>
              <td>{{ patient.email }}</td>
              <td class="text-center">{{ patient.mobile_no }}</td>
              <td class="text-center">{{ patient.membership_no }}</td>
            {% if rank in "it_officer" %}
                 <td class="d-flex justify-content-center align-items-center gap-1">
                  <button class="btn btn-sm  generic-edit-btn btn-warning rounded" data-url="{% url 'generic_edit' 'patient' patient.id %}" data-target="#editGenericModal">
                    <i class="bi bi-pencil"></i>
                  </button> 
                  <button class="btn btn-sm generic-delete-btn btn-danger rounded" data-url="{% url 'generic_delete' 'patient' patient.id %}" data-target="#deleteGenericModal">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
         {% else %}
   <td>View</td>
      {% endif %}

          </tr>
          {% endfor %}
        </tbody>
      </table>
              <!-- Pagination controls: numbers only -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% for num in patients.paginator.page_range %}
                    {% if patients.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
        </nav>
      </form>

      </div>
      </div>
      </div>
      </div>
      </div>

      <script>
        document.getElementById('select-all-patients').addEventListener('click', function() {
          var checkboxes = document.querySelectorAll('input[name="selected_patients"]');
          for (var checkbox of checkboxes) {
            checkbox.checked = this.checked;
          }
        });
      </script>

{% endif %}
<!-- end list of  patients -->




{% endblock %}