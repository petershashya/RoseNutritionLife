{% extends 'layout.html' %}


{% block content %}
{% load static %}  


<div class="p-3 mt-5"></div>


{% if rank in "it_officer,director,vice_director,doctor" %}
<div >
    <span id="category_title" class="d-flex justify-content-center align-items-center mt-3  mx-3 p-1 rounded" style="color:rgb(4, 70, 39);font-size:1.2rem;">
          <i class="bi bi-cash-coin text-success mx-1" style="font-size:1.2rem;"></i>PAYMENTS DETAILS </span>
    <ul class="nav nav-pills d-flex justify-content-center aling-items-center gap-2 mt-2">
        <li class="nav-item">
          <a class="nav-link " data-bs-toggle="pill" href="#members_list" > <i class="bi bi-coin mx-1"  style="font-size:1rem;"></i> Pendings List   </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " data-bs-toggle="pill" href="#payments_list" > <i class="bi bi-cash-coin mx-1"  style="font-size:1rem;"></i>Payments List </a>
        </li>
      </ul>
      

      <!-- Tab panes -->
      <div class="tab-content p-2">
        <div class="tab-pane container-fill active rounded" id="members_list" >   
         <div class="rounded" >


        <div class="alert alert-info alert-dismissible mx-3 mt-2 shadow border-0 bg-white">
        <span class="d-flex justify-content-center aling-items-center text-info">
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          <i class="bi bi-info-circle mx-2" style="font-size:1rem;" ></i> Select and Click pay to see pending details
        </span>
      </div>
          
<!-- start listing patients -->
<!-- Patients Table -->
{% if rank in "it_officer,director,vice_director,doctor,reception" %}
  <div class="mb-4 mt-2 d-flex justify-content-center  align-items-center">
<div class="shadow  container bg-white p-3 "
     style=" border-radius:20px;">

  <div class="tab-content">
    <div id="users" class="tab-pane active">
     
      <h3 class="d-flex justify-content-center mt-3"> List of Pending members </h3>
            <!-- counts + add -->
      <span class="d-flex justify-content-center align-items-center gap-2 mb-2">
        <a class="text-light btn btn-sm" style="background-color: rgb(4, 70, 39); border-radius:30px;">
          <!-- Total Patients --> List of pendings  {{ member_count }}
        </a>
      </span>  

      <div class="mx-3 mb-2">
    <input type="text" id="pendingSearchInput" placeholder="Search pending by No or Name" class="form-control border-info">
      </div>

          <div class="table-responsive-sm">

          <form method="GET" action="">
                {% csrf_token %}
                    <table class="table table-bordered table-hover table-stripped">
                    <thead>
                        <tr>
                            <th>Membership No</th>
                            <th>Member Name</th>
                            <th>Total PV</th>
                            <th>Money</th>
                            <th>Month</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>

                    <tbody id="pendingTableBody">
                        {% for m in members %}
                        <tr>
                            <td class="text-center">{{ m.membership_no }}</td>
                            <td class="text-center">{{ m.member_name }}</td>
                            <td class="text-center">{{ m.total_pv }}</td>
                            <td class="text-center">{{ m.money }}</td>
                            <td class="text-center">{{ m.month }}</td>
                            <td class="text-center">
                                {% if m.status == "Paid" %}
                                    <span class="badge bg-success">Paid</span>
                                {% else %}
                                    <span class="badge bg-danger">Pending</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <button type="button" class="btn btn-primary btn-sm open-member-modal"
                                        data-url="{% url 'view_member_pending' m.membership_no %}">
                                    View
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

              <!-- Pagination controls: numbers only -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% for num in members.paginator.page_range %}
                    {% if members.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
        </nav>
      </form>

      </div>
      </div>
      </div>
      </div>
      </div>

      <script>
        document.getElementById('select-all-members').addEventListener('click', function() {
          var checkboxes = document.querySelectorAll('input[name="selected_members"]');
          for (var checkbox of checkboxes) {
            checkbox.checked = this.checked;
          }
        });
      </script>

      {% endif %}
<!-- end list of  patients -->
         </div>
        </div>



        <!-- Modal container -->
<div id="memberspendinglist"></div>

        <!-- Modal container -->
<div id="memberspaymentlist"></div>



         <!-- start MEDICALS LIST-->
        <div class="tab-pane container-fill fade rounded" id="payments_list" >   
         <div class="rounded" >

      <div class="alert alert-info alert-dismissible mx-3 mt-2 shadow border-0 bg-white">
        <span class="d-flex justify-content-center aling-items-center text-info">
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          <i class="bi bi-info-circle mx-2" style="font-size:1rem;" ></i> Select and Click viewto see payment details
        </span>
      </div>
<!-- start listing patients -->
<!-- Patients Table -->
{% if rank in "it_officer,director,vice_director,doctor,reception" %}
  <div class="mb-4 mt-2 d-flex justify-content-center  align-items-center">
<div class="shadow  container bg-white p-3 "
     style=" border-radius:20px;">

  <div class="tab-content">
    <div id="users" class="tab-pane active">
     
      <h3 class="d-flex justify-content-center mt-3"> List of Paid members </h3>
            <!-- counts + add -->
      <span class="d-flex justify-content-center align-items-center gap-2 mb-2">
        <a class="text-light btn btn-sm" style="background-color: rgb(4, 70, 39); border-radius:30px;">
          Total payments  {{ payment_count }}
        </a>
      </span>

      <div class="mx-3 mb-2">
    <input type="text" id="paymentSearchInput" placeholder="Search paid by No or Name" class="form-control border-info">
      </div>

            <div class="table-responsive-sm">
            <form method="GET" action="">
                  {% csrf_token %}

            <table class="table table-bordered table-striped table-hover">
                <thead class="text-center">
                    <tr>
                        <th>#</th>
                        <th>Membership No</th>
                        <th>Member Name</th>
                        <th>Total PV</th>
                        <th>Money (TZS)</th>
                        <th>Month</th>
                        <th>Date Created</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody id="paymentsTableBody">
                    {% for p in payments %}
                    <tr class="text-center">
                        <td  class="text-center">{{ forloop.counter }}</td>
                        <td  class="text-center">{{ p.membership_no }}</td>
                        <td  class="text-center">{{ p.member_name }}</td>
                        <td  class="text-center">{{ p.total_pv }}</td>
                        <td  class="text-center">{{ p.money }}</td>
                        <td  class="text-center">{{ p.month }}</td>
                        <td>{{ p.date_created|date:"Y-m-d H:i" }}</td>
                        <td class="text-center">
                            <button type="button" class="btn btn-primary btn-sm open-payment-modal"
                                    data-url="{% url 'view_member_payment' p.membership_no %}">
                                    <i class="bi bi-eye mx-1"></i>
                                View
                            </button>
                            <button type="button"
                                    class="btn btn-secondary btn-sm open-payment-modal"
                                    data-url="{% url 'print_member_payment' p.membership_no %}"
                                    data-month="{{ selected_month|default:'' }}">
                                <i class="bi bi-printer mx-1"></i>print
                            </button>
                            
                            {% if rank in "it_officer" %}
                            <button class="btn btn-sm  generic-edit-btn btn-warning rounded-pill" data-url="{% url 'generic_edit' 'payment' p.id %}" data-target="#editGenericModal">
                              <i class="bi bi-pencil"></i>
                            </button>
                           {% endif %}
                            <button class="btn btn-sm generic-delete-btn btn-danger rounded-pill" data-url="{% url 'generic_delete' 'payment' p.id %}" data-target="#deleteGenericModal">
                              <i class="bi bi-trash"></i>
                            </button>

                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" class="text-center text-danger">
                            No payment records found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        <!-- Pagination controls: numbers only -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% for num in payments.paginator.page_range %}
                    {% if payments.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
        </nav>
        </form>

        </div>
        </div>
        </div>
        </div>
        </div>

        <script>
          document.getElementById('select-all-payments').addEventListener('click', function() {
            var checkboxes = document.querySelectorAll('input[name="selected_payments"]');
            for (var checkbox of checkboxes) {
              checkbox.checked = this.checked;
            }
          });
        </script>

        {% endif %}
        <!-- end list of  medicals -->

         </div>
        </div>


{% endif %}

{% endblock %}